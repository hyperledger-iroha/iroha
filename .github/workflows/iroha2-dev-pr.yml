name: Iroha 2 dev branch pull requests workflow
on:
  pull_request:
    branches: [iroha2-dev]
env:
  CACHE_PATHS: |
    ~/.cargo/registry
    ~/.cargo/git
    ~/.rustup
    target
    iroha/target
    iroha_client/target


jobs:
  deploy:
    runs-on: [ self-hosted, Linux ]
    container: rust:1.52-buster
    steps:
      - uses: actions/checkout@v2
      - name: Build and push Iroha Docker image
        uses: docker/build-push-action@v1.1.0
        with:
          username: "rkharisov"
          password: "Kf#=*-3e&cuT@Raf"
          repository: "rkharisov/iroha"
          tags: iroha2-dev
          build_args: TARGET_DIR=release,PROFILE=--release
      - name: Build and push Iroha Client CLI Docker image
        uses: docker/build-push-action@v1.1.0
        with:
          username: "rkharisov"
          password: "Kf#=*-3e&cuT@Raf"
          repository: "rkharisov/iroha"
          tags: iroha2-client-cli-dev
          build_args: BIN=iroha_client_cli,TARGET_DIR=release,PROFILE=--release
      - name: Build and push Iroha Crypto CLI Docker image
        uses: docker/build-push-action@v1.1.0
        with:
          username: "rkharisov"
          password: "Kf#=*-3e&cuT@Raf"
          repository: "rkharisov/iroha"
          tags: iroha2-crypto-cli-dev
          build_args: BIN=iroha_crypto_cli,TARGET_DIR=release,PROFILE=--release
