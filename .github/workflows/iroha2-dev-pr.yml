name: I2::Dev::Tests

on:
  pull_request:
    branches: [iroha2-dev]
    paths:
      - '**.rs'
      - '**.json'
      - '**.toml'
      - '.github/workflows/**.yml'

      # Not part of the workspace
      - '!wasm/**'

concurrency:
  group: ${{ github.workflow }}-${{ github.ref }}
  cancel-in-progress: true

env:
  CARGO_TERM_COLOR: always

jobs:
  check:
    runs-on: ubuntu-latest
    container:
      image: 7272721/i2-ci:nightly
    steps:
      - uses: actions/checkout@v3
      - uses: Swatinem/rust-cache@v2
      - name: Check config.md
        if: always()
        run: ./scripts/check.sh docs
      - name: Check genesis.json
        if: always()
        run: ./scripts/check.sh genesis
      - name: Check client_cli/config.json
        if: always()
        run: ./scripts/check.sh client
      - name: Check schema.json
        if: always()
        run: ./scripts/check.sh schema
      - name: Wasm build check
        if: always()
        working-directory: wasm
        run: mold --run cargo +nightly-2022-08-15 build --target wasm32-unknown-unknown --quiet
