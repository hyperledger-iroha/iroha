From cd8a1421fd781c83eda3a8a9c4e072805a259b37 Mon Sep 17 00:00:00 2001
From: iceseer <iceseer@gmail.com>
Date: Tue, 19 Jan 2021 12:38:23 +0300
Subject: [PATCH] remove exception handle

Signed-off-by: iceseer <iceseer@gmail.com>
---
 ports/rxcpp/0001-crash-uncaught.patch | 35 +++++++++++++++++++++++++++
 ports/rxcpp/portfile.cmake            |  2 +-
 2 files changed, 36 insertions(+), 1 deletion(-)
 create mode 100644 ports/rxcpp/0001-crash-uncaught.patch

diff --git a/ports/rxcpp/0001-crash-uncaught.patch b/ports/rxcpp/0001-crash-uncaught.patch
new file mode 100644
index 0000000..79ffdbd
--- /dev/null
+++ b/ports/rxcpp/0001-crash-uncaught.patch
@@ -0,0 +1,35 @@
+From d1dc940bddfd43cade8afb8e31e1fea8ee6d15b2 Mon Sep 17 00:00:00 2001
+From: iceseer <iceseer@gmail.com>
+Date: Mon, 18 Jan 2021 19:52:44 +0300
+Subject: [PATCH] crash uncaught
+
+Signed-off-by: iceseer <iceseer@gmail.com>
+---
+ Rx/v2/src/rxcpp/rx-subscriber.hpp | 11 ++---------
+ 1 file changed, 2 insertions(+), 9 deletions(-)
+
+diff --git a/Rx/v2/src/rxcpp/rx-subscriber.hpp b/Rx/v2/src/rxcpp/rx-subscriber.hpp
+index 3d6c515..d46b649 100644
+--- a/Rx/v2/src/rxcpp/rx-subscriber.hpp
++++ b/Rx/v2/src/rxcpp/rx-subscriber.hpp
+@@ -50,15 +50,8 @@ class subscriber : public subscriber_base<T>
+         template<class U>
+         void operator()(U u) {
+             trace_activity().on_next_enter(*that, u);
+-            RXCPP_TRY {
+-                that->destination.on_next(std::move(u));
+-                do_unsubscribe = false;
+-            } RXCPP_CATCH(...) {
+-                auto ex = rxu::current_exception();
+-                trace_activity().on_error_enter(*that, ex);
+-                that->destination.on_error(std::move(ex));
+-                trace_activity().on_error_return(*that);
+-            }
++            that->destination.on_next(std::move(u));
++            do_unsubscribe = false;
+         }
+         const this_type* that;
+         volatile bool do_unsubscribe;
+-- 
+2.30.0
+
diff --git a/ports/rxcpp/portfile.cmake b/ports/rxcpp/portfile.cmake
index b987011..1ec648e 100644
--- a/ports/rxcpp/portfile.cmake
+++ b/ports/rxcpp/portfile.cmake
@@ -4,7 +4,7 @@ vcpkg_from_github(
     REF v4.1.0
     SHA512 a92e817ecbdf6f235cae724ada2615af9fa0c243249625d0f2c2f09ff5dd7f53fdabd03a0278fe2995fe27528c5511d71f87b7a6b3d54f73b49b65aef56e32fd
     HEAD_REF master
-    PATCHES support_find_package.patch
+    PATCHES support_find_package.patch 0001-crash-uncaught.patch
 )
 
 vcpkg_configure_cmake(
-- 
2.30.0

